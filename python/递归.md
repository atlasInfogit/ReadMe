```python
import re
import pymysql
import json
import requests


def request(url, params):
    """
    发送请求
    :param url: string 请求URL
    :param params: 请求参数
    :return: 列表
    """
    if url:
        try:
            response = requests.post(url=url, data=params)
            data = json.loads(response.text)
            if len(data) > 0:
                for item in data:
                    if (params.__contains__("id")):
                        item["parentid"] = params["id"]
                return data
            else:
                return None
        except Exception as e:
            print(e)
    else:
        return 'url为空'


def conversion(data):
    """
    数据处理，数据转换
    :param data: 存储dict的字典
    :return: item字典
    """
    if data:
        try:
            lst = []
            for item in data:
                dic = {}
                for k, v in item.items():
                    dic[k] = v
                lst.append(dic)
            return lst
        except Exception as e:
            print(e)
    else:
        return None


# 递归函数

def recursive(count, result, parentId):
    url = 'http://127.0.0.1:8081/browse/taxa_tree_children'
    if count == 0:
        params = {
            'otherParam': 'zTreeAsyncTest'
        }
    else:
        params = {
            'id': parentId,
            'otherParam': 'zTreeAsyncTest'
        }
    # 第一次请求
    print(params)
    # 得到<k,v>的列表list
    data = request(url, params)
    if len(data) > 0:
        # 得到所有数据[<k,v>,<k,v>]
        # for item in data:
        getChild(result, 'a2a668d8-1caf-4763-8b79-ef00e1c7368d', 0)
        count += 1
        # 存到excel或者mysql

    return result
    # s = len(result)
    # b = [x["id"] for x in result]
    # print(s)


def getChild(treelst, parentId, lv):
    url = 'http://127.0.0.1:8081/browse/taxa_tree_children'
    params = {
        'id': parentId,
        'otherParam': 'zTreeAsyncTest',
        'lv': lv
    }
    lv += 1
    data = request(url, params)
    if (isinstance(data, list) and len(data) > 0):
        treelst += data
        for i in data:
            if i["isParent"]:
                getChild(treelst, i["id"], lv)
            else:
                lv = 0


def rules(text):
    pre = re.compile('>(.*?)<')
    s1 = ''.join(pre.findall(text)).replace(')', '')
    s2 = s1.replace('(', '')
    return s2


def con():
    db = pymysql.connect(host='localhost', user='root', password='hh226752', db='data', charset='utf8')
    return db


def scheduler():
    result = []

    res = recursive(0, result, "0")
    for r in res:
        print(r)
    # conn = con()
    # cursor = conn.cursor()
    # try:
    #     for i in res:
    #         print(i)
    #         name = rules(i['name'])
    #         # print(name)
    #         sql = "insert into catalogue(id, name) VALUES ('{0}', '{1}')".format(i['id'], name)
    #         # print(sql)
    #         cursor.execute(sql)
    #         conn.commit()
    # except Exception as e:
    #     # print(sql)
    #     print(e)
    #     raise
    # print(i)
    # s = 2


def main():
    scheduler()


if __name__ == '__main__':
    main()

```

